<link rel="import" href="coinify-shared.html"> <link rel="import" href="coinify-overlay.html"> <dom-module id="coinify-buy-select-payment-method"> <template> <style include="coinify-shared"></style> <style>.hidden-list-item{display:none!important}.text-notification{max-width:400px}.disabled-payment-option{opacity:.6}label{float:left;width:290px}label strong{font-size:16px;font-weight:400}label span{font-size:12px}label input{margin-top:15px}.accepted-cards{float:left;width:100px}.tp{float:left;width:30px}.go-back{text-decoration:underline;cursor:pointer;padding:8px 0 0 3px}.row>label{min-width:310px}</style> <h4>Select your preferred payment method:</h4> <div class$="radio {{cardEnabledStyle}}"> <div class="row"> <label> <div class="col-xs-2"> <input disabled="{{!isCardEnabled}}" value="card" type="radio" name="method" on-tap="paymentMethodChanged"> <fa-awesome icon="fa:credit-card" size="40"></fa-awesome> </div> <div class="col-xs-10"> <strong>Credit/Debit Card</strong> <br> <span>Instant transaction | [[_getFeeForPaymentMethod(paymentMethodsResponse, &apos;card&apos;)]]</span> </div> </label> <div class="accepted-cards"> <fa-awesome icon="fa:cc-visa" size="40"></fa-awesome> <fa-awesome icon="fa:cc-mastercard" size="40"></fa-awesome> </div> <div class="tp"> <coinify-info width="200"> The payment fee is charged for the convenience and speed of the checkout. </coinify-info> </div> </div> </div> <template is="dom-repeat" items="{{cardList}}"> <style>label{float:left;width:290px}label strong{font-size:16px;font-weight:400}label span{font-size:12px}label input{margin-top:15px}.accepted-cards{float:left;width:100px}.tp{float:left;width:30px}.go-back{text-decoration:underline;cursor:pointer;padding:8px 0 0 3px}</style> <div class$="radio {{cardEnabledStyle}}"> <div class="row"> <label> <div class="col-xs-2"> <input value="{{_itemToJSON(item)}}" disabled="{{!isCardEnabled}}" type="radio" name="method" on-tap="paymentMethodChanged"> <fa-awesome icon="fa:credit-card" size="40"></fa-awesome> </div> <div class="col-xs-10"> <strong>Card - [[_getCardName(item)]]</strong> <br> <span>Instant transaction | [[_getFeeForPaymentMethod(paymentMethodsResponse, &apos;card&apos;)]]</span> </div> </label> <div class="accepted-cards"> </div> <div class="tp"> <coinify-info width="200"> The payment fee is charged for the convenience and speed of the checkout. </coinify-info> </div> </div> </div> </template> <div class$="radio {{bankEnabledStyle}}"> <div class="row"> <label> <div class="col-xs-2"> <input value="bank" disabled="{{!isBankEnabled}}" type="radio" name="method" on-tap="paymentMethodChanged"> <fa-awesome icon="fa:university" size="40"></fa-awesome> </div> <div class="col-xs-10"> <strong>Bank Transfer</strong> <br> <span>2-3 days | [[_getFeeForPaymentMethod(paymentMethodsResponse, &apos;bank&apos;)]]</span> </div> </label> <div class="tp"> <coinify-info width="200"> We will send you the bitcoin within 24 hours on business days after we receive your payment. The final exchange rate will be determined once your bank order is processed. Note that on weekends bank transfers are not processed. </coinify-info> </div> </div> </div> <template is="dom-if" if="[[isMethodAndTraderLevel1(paymentMethod, &apos;bank&apos;)]]"> <div class="text-notification"> <p> Please note that in order to buy bitcoin via bank transfer, you will need to verify your identity. You will only have to do this once. </p> </div> </template> <p> </p><div> <button on-tap="paymentMethodSelected" disabled="{{!isInputValid}}" class="pull-right btn btn-success" type="button">Continue</button> <p class="go-back" on-tap="onGoBack">Go back</p> </div> <p></p> <coinify-overlay id="cvvDialog" with-backdrop=""> <div class="form-group"> <label class="control-label" for="danish-bank-name">Card CVV code</label> <input is="iron-input" bind-value="{{CVV}}" class="form-control" id="card-cvv" maxlength="3" type="" on-input="_validateCVV" autocomplete="off"> </div> <button on-tap="_onCVVDialogCancel" class="btn btn-default">Cancel</button> <button on-tap="_onCVVDialogSubmit" class="btn btn-success pull-right" disabled$="[[!cvvFormatOk]]">Okay</button> </coinify-overlay> </template> <script>Polymer({is:"coinify-buy-select-payment-method",properties:{traderInfo:Object,paymentMethod:{type:String,notify:!0},isSavedCard:{type:Boolean,value:!1},selectedCardId:{type:String},isInputValid:{type:Boolean,value:!1},cards:{type:Object,notify:!0,observer:"_onCardsUpdated"},paymentMethodsResponse:Object,cardList:{type:Array,computed:"_getCardList( cards, cardTokenizationEnabled )"},cardTokenizationEnabled:{type:Boolean,notify:!0},CVV:{type:String},cvvFormatOk:{type:Boolean,value:!1},cvvDialogCallback:{type:Object,value:null},isCardEnabled:{type:Boolean,value:!0,notify:!0,observer:"_onCardEnabledUpdated"},isBankEnabled:{type:Boolean,value:!0,notify:!0,observer:"_onBankEnabledUpdated"},cardEnabledStyle:{type:String,computed:"_getRatioClass(isCardEnabled)"},bankEnabledStyle:{type:String,computed:"_getRatioClass(isBankEnabled)"}},paymentMethodChanged:function(){var e=this.$$('input[name="method"]:checked');if(!e)return void console.log("input not found");var t=e.value;this.isSavedCard=!1,this.selectedCardId=null,this.CVV="",this.cvvFormatOk=!1,t.indexOf("{")>=0?(t=JSON.parse(t),this.selectedCardId=t.cardExternalId,this.isSavedCard=!0,this.paymentMethod="card",t="card"):"card-register"==t?(console.log("Register card."),this.paymentMethod="card-register"):this.paymentMethod=t,t&&(this.isInputValid=!0)},_getRatioClass:function(e){return e?"":"disabled-payment-option"},_onCardEnabledUpdated:function(e){},_onBankEnabledUpdated:function(e){},_itemToJSON:function(e){return JSON.stringify(e||{})},paymentMethodSelected:function(){var e=this,t={method:this.paymentMethod};return this.isSavedCard?(this.cvvDialogCallback=function(a){e.cvvDialogCallback=null,a&&e.CVV&&(t.card={cardExternalId:e.selectedCardId,CVV:e.CVV},e.fire("continue",t,{bubbles:!1}))},void this.$.cvvDialog.open()):void this.fire("continue",t,{bubbles:!1})},onGoBack:function(){this.fire("cancel",null,{bubbles:!1})},isMethodAndTraderLevel1:function(e,t){var a=this.traderInfo&&this.traderInfo.level&&1===this.traderInfo.level.id;return e===t&&a},_onCardsUpdated:function(){},_getCardList:function(e,t){var a=this;return e&&e.length&&t?e.map(function(e){return{savedCard:!0,cardExternalId:e.cardExternalId,CVV:a.CVV,cardName:e.lastFour.replace("(","").replace(")","")}}):[]},_getCardName:function(e){return e.cardName},resetElement:function(){var e=this.$$('input[name="method"]:checked');return e?(e.checked=!1,this.paymentMethod=null,void(this.isInputValid=!1)):void console.log("input not found")},_getFeeForPaymentMethod:function(e,t){var a=e.find(function(e){return e.inMedium===t}),n=a.inPercentageFee;return 0===n?"No payment fees":n+"% payment fee"},_onCVVDialogCancel:function(){this.$.cvvDialog.close(),this.CVV=null,this.cvvFormatOk=!1,this.cvvDialogCallback&&this.cvvDialogCallback(this.cvvFormatOk)},_onCVVDialogSubmit:function(){this.$.cvvDialog.close(),this.CVV=this.CVV.replace(/\s/g,"").replace(/\D/g,""),this.cvvFormatOk=this.CVV&&3===this.CVV.length,this.cvvDialogCallback&&this.cvvDialogCallback(this.cvvFormatOk)},_validateCVV:function(e){var t=(e.target.value||"").replace(/\s/g,"").replace(/\D/g,"");t.length>3&&(t=t.substring(0,3)),this.cvvFormatOk=this.CVV&&3===this.CVV.length,e.target.value=t}})</script> </dom-module>