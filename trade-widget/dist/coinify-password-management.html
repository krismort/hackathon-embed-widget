<link rel="import" href="coinify-shared.html"> <link rel="import" href="coinify-api-behaviour.html"> <link rel="import" href="../../iron-input/iron-input.html"> <link rel="import" href="coinify-alert-message.html"> <dom-module id="coinify-password-management"> <template> <style include="coinify-shared"></style> <iron-ajax id="updateUserEndpoint" headers="{{ajaxHeaders}}" url="{{coinifyApiBaseUrl}}/users/me" body="{{updatePasswordBody}}" on-error="_handleUpdatePasswordError" method="PATCH" content-type="application/json" handle-as="json"> </iron-ajax> <h4>Change password</h4> <coinify-alert-message id="alertMessage"></coinify-alert-message> <div class="alert alert-success" hidden$="[[!passwordUpdatedSuccessfully]]"> <strong>Success!</strong> Password updated </div> <form id="passwordForm" on-submit="_updatePassword"> <div class="form-group"> <label>Old password</label> <input is="iron-input" bind-value="{{oldPassword}}" type="password" required class="form-control"> </div> <div class="form-group"> <label>New password</label> <input is="iron-input" bind-value="{{newPassword}}" type="password" required minlength="8" class="form-control"> </div> <div class="form-group"> <label>Confirm new password</label> <input is="iron-input" bind-value="{{newPasswordConfirm}}" type="password" required minlength="8" class="form-control"> </div> <div class="clearfix"> <button type="submit" class="btn btn-success pull-right" id="updatePasswordSubmitButton">Update</button> </div> </form> </template> <script>Polymer({is:"coinify-password-management",behaviors:[CoinifyApiBehaviour],properties:{oldPassword:String,newPassword:String,newPasswordConfirm:String,updatePasswordBody:{type:Object,computed:"_computeUpdatePasswordBody(oldPassword, newPassword)"},passwordUpdatedSuccessfully:{type:Boolean,value:!1}},_computeUpdatePasswordBody:function(s,e){return{oldPassword:s,newPassword:e}},_updatePassword:function(s){var e=this;if(s.preventDefault(),this.$.alertMessage.alertMessage="",this.newPassword!==this.newPasswordConfirm)return void this._showAlert("danger","New password and Confirm new password does not match");this.$.updatePasswordSubmitButton.disabled=!0;var r=this.$.updateUserEndpoint.generateRequest();r.completes.then(function(){e._showAlert("success","Password updated successfully!"),e.$.passwordForm.reset()},function(s){console.log(s)}).then(function(){e.$.updatePasswordSubmitButton.disabled=!1})},_handleUpdatePasswordError:function(s){var e=void 0;try{e=s.detail.request.xhr.response.error}catch(r){return void this._showAlert("danger","Unknown error")}switch(console.log("_handleUpdatePasswordError",e),e){case"wrong_password":this._showAlert("danger","Old password not correct");break;case"invalid_request":this._showAlert("danger","Old password not correct");break;default:this._showAlert("danger","Unknown error")}},_showAlert:function(s,e){this.$.alertMessage.alertMessage=e,this.$.alertMessage.alertType=s}})</script> </dom-module>