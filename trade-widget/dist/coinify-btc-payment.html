<link rel="import" href="coinify-shared.html"> <link rel="import" href="coinify-api-behaviour.html"> <link rel="import" href="libraries/qrcode.html"> <link rel="import" href="../../progress-bubble/progress-bubble.html"> <link rel="import" href="../../fa-awesome/fa-awesome.html"> <dom-module id="coinify-btc-payment"> <template> <style include="coinify-shared">progress-bubble{display:inline-block;width:50px;height:50px;margin:5px;font-size:14px;color:#717171;text-shadow:none;--progress-bubble-stroke-color:#8ec165;--progress-bubble-bg-stroke-color:rgba(193, 193, 193, 0.2);--progress-bubble-background:transparent;--progress-bubble-reflection-display:none}.btn-icon-text{float:right;padding-left:5px}</style> <iron-ajax id="tradeEndpoint" headers="{{ajaxHeaders}}" url="{{coinifyApiBaseUrl}}/trades/{{trade.id}}" last-response="{{trade}}" on-error="_handleApiError" handleas="json"> </iron-ajax> <div class="container-fluid"> <div class="row"> <div class="col-sm-12 text-center"> <p>Please send exactly <strong>{{trade.transferIn.sendAmount}}</strong> bitcoin (excluding fee) to Bitcoin address </p> <p> <strong>{{trade.transferIn.details.account}}</strong> </p> </div> </div> <div class="row"> <div id="qrcode" class="col-sm-6 text-center"> <p>Scan to Pay</p> </div> <div class="col-sm-6 text-center"> <p> </p><h4>{{trade.transferIn.sendAmount}} BTC</h4> <a href="{{_generateBitcoinUri(trade)}}" class="btn btn-info"> <fa-awesome class="iconszz" icon="fa:btc" size="16"></fa-awesome> <div class="btn-icon-text"> Click to Pay </div> </a> <p></p> </div> </div> <div class="row"> <div class="col-sm-12"> <button on-tap="_submitContinue" class="btn btn-success pull-right">I have now sent bitcoin</button> </div> </div> </div> </template> <script>Polymer({is:"coinify-btc-payment",behaviors:[CoinifyApiBehaviour],properties:{errorMessage:{type:String,observer:"_errorMessageChanged"},trade:{type:Object,observer:"_tradeChanged"},bankAccounts:Object,bitcoinPaymentStatus:{type:String,computed:"_computeBitcoinPaymentStatus(trade)"},secondsToStateRefresh:Number,secondsToStateRefreshDisplay:{type:String,computed:"_computeSecondsToStateRefreshDisplay(secondsToStateRefresh)"}},ready:function(){},_tradeChanged:function(e){var t=this;e&&(Polymer.dom(this.$.qrcode).children.forEach(function(e){Polymer.dom(t.$.qrcode).removeChild(e)}),new QRCode(this.$.qrcode,{text:this._generateBitcoinUri(e),width:125,height:125}))},_generateBitcoinUri:function(e){return e&&e.transferIn&&e.transferIn.details?"bitcoin:"+e.transferIn.details.account+"?amount="+e.transferIn.sendAmount:""},_computeBitcoinPaymentStatus:function(e){if(!e)return"Something went wrong...";switch(e.state){case"awaiting_transfer_in":return"Not received";case"processing":return"Received!";default:return"Something went wrong..."}},_countDownToStateRefresh:function(){this.secondsToStateRefresh?(this.secondsToStateRefresh=parseFloat((this.secondsToStateRefresh-.1).toFixed(1)),this.secondsToStateRefresh<=0&&this.$.tradeEndpoint.generateRequest()):this.secondsToStateRefresh=10,this.async(this._countDownToStateRefresh,100)},_computeSecondsToStateRefreshDisplay:function(e){return e.toFixed(0)},_submitContinue:function(e){e.preventDefault(),this.fire("continue",null,{bubbles:!1})},_handleApiError:function(e,t){this.fire("error",{request:t.request,error:t.error},{bubbles:!1})}})</script> </dom-module>