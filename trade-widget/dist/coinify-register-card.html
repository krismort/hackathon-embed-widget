<link rel="import" href="coinify-shared.html"> <link rel="import" href="coinify-api-behaviour.html"> <link rel="import" href="../../iron-input/iron-input.html"> <dom-module id="coinify-register-card"> <template> <style include="coinify-shared">.asteriskField{color:red}.add-bank-{background:0 0!important;border:none;padding:0!important;font:inherit}.save-card-label{margin-left:-20px!important;width:190px!important}</style> <coinify-alert-message id="errorBox" alert-message="[[errorMessage]]"></coinify-alert-message> <div class="panel-group"> <div class="panel panel-default"> <div class="panel-heading"> <h4 class="panel-title">Enter credit/debit card info</h4> </div> <div id="cardPanel" class="panel"> <div class="panel-body"> <div class="container-fluid"> <form id="cardForm" on-submit="_submitCard"> <div class="row"> <div> <div class="form-group"> <label class="control-label" for="danish-bank-name"> Name<span class="asteriskField">*</span> </label> <input is="iron-input" bind-value="{{cardData.cardHolderName}}" class="form-control" id="card-holder-name" maxlength="255" type="text" on-input="_validateCardHolderName" required> </div> <div class="form-group"> <label class="control-label requiredField" for="card-number"> Card number<span class="asteriskField">*</span> </label> <input is="iron-input" bind-value="{{cardData.cardNumber}}" class="form-control" id="card-number" type="text" maxlength="19" on-input="_validateCardNumberInput" required> </div> <div class="form-group"> <label class="control-label requiredField" for="card-expmonth"> Expiration Month<span class="asteriskField">*</span> </label> <input class="form-control" is="iron-input" bind-value="{{cardData.expirationMonth}}" id="card-expmonth" type="number" maxlength="2" on-input="_validateMonthInput" required> </div> <div class="form-group"> <label class="control-label requiredField" for="card-expyear"> Expiration Year<span class="asteriskField">*</span> </label> <input class="form-control" is="iron-input" bind-value="{{cardData.expirationYear}}" id="card-expyear" type="number" maxlength="2" on-input="_validateYearInput" required> </div> <div class="form-group"> <label class="control-label requiredField" for="card-cvv"> CVV<span class="asteriskField">*</span> </label> <input class="form-control" is="iron-input" bind-value="{{cardData.CVV}}" id="card-cvv" type="number" maxlength="3" on-input="_validateCVVInput" required> </div> <div class="form-group"> <div class="checkbox"> <label> <input id="save-card" type="checkbox" checked="{{saveCard}}" on-click="_checkBoxClicked"> <label class="save-card-label" for="save-card">save card</label> </label> </div> </div> <div class="form-group pull-right"> <div> <button class="btn btn-default" on-tap="_cancel" type="button"> Cancel </button> <button class="btn btn-success" type="submit"> Continue </button> </div> </div> </div> </div> </form> </div> </div> </div> </div> </div> </template> <script>Polymer({is:"coinify-register-card",behaviors:[CoinifyApiBehaviour],properties:{errorMessage:String,cardData:{type:Object,value:{cardNumber:"",cardHolderName:"",expirationMonth:"",expirationYear:"",CVV:""},observer:"_onCardDataPropertyChanged"},saveCard:{type:Boolean,value:!0,notify:!0},listening:!1},attached:function(){window.CoinifyPspLib.setOptions({accessToken:this.accessToken,coinifyApiBaseUrl:this.coinifyApiBaseUrl,verbose:!1})},_handleIntApiResponse:function(e){this.fire("created",null,{bubbles:!1}),this._hideIntBankForm(),this.$.intBankForm.reset()},_checkBoxClicked:function(){this.saveCard=this.$["save-card"].checked},_onCardDataPropertyChanged:function(){},_resetForm:function(){this.saveCard=!0,this.cardData={cardNumber:"",cardHolderName:"",expirationMonth:"",expirationYear:"",CVV:""}},_submitCard:function(e){var a=this;e.preventDefault();var t=this,r=Object.assign({},this.cardData);window.CoinifyPspLib.registerCard({card:r,saveCard:this.saveCard}).then(function(e){var r={};t.saveCard?(r.cardExternalId=e.cardExternalId,r.CVV=a.cardData.CVV,r.cardExternalId&&r.CVV||console.error("cardExternalId not given in data ",e)):(r.ccTempToken=e.ccTempToken,r.CVV=a.cardData.CVV,r.sessionToken=e.sessionToken,r.ccTempToken&&r.sessionToken&&r.CVV||console.error("ccTempToken|sessionToken|CVV not in data",r)),t.fire("continue",r,{bubbles:!1})})["catch"](function(e){t.errorMessage="Failed to submit card details. Please validate card details and try again."})},_validateCardNumberInput:function(e){var a=(e.target.value||"").replace(/\s/g,"").replace(/\D/g,"");a.length>16&&(a=a.substring(0,16));for(var t="",r=0;r<a.length;r++)r%4===0&&r>0&&(t+=" "),t=t.concat(a[r]);e.target.value=t},_validateCardHolderName:function(e){var a=e.target.value||"";2==a.length&&" "===a[a.length-1]&&(a=a.replace(/\s/g,"")),a=a.replace(/\s\s+/g," "),a.length>255&&(a=a.substring(0,255)),e.target.value=a},_validateMonthInput:function(e){var a=e.target.value||"";a=a.replace(/\s/g,""),a.length>2&&(a=a.substring(0,2)),e.target.value=a},_validateYearInput:function(e){var a=e.target.value||"";a=a.replace(/\s/g,""),a.length>4&&(a=a.substring(0,4)),e.target.value=a},_validateCVVInput:function(e){var a=e.target.value||"";a=a.replace(/\s/g,""),a.length>3&&(a=a.substring(0,3)),e.target.value=a},_cancel:function(e){this.fire("cancel",null,{bubbles:!1}),this.$.cardForm.reset()}})</script> </dom-module>