<link rel="import" href="../../polymer/polymer.html"> <link rel="import" href="coinify-shared.html"> <link rel="import" href="coinify-api-behaviour.html"> <dom-module id="coinify-paylike-payment-handler"> <style include="coinify-shared"></style> <template> <form id="paylikeForm" on-submit="_submitPaylikeForm"> <div class="row"> <div class="col-sm-6"> <h4>Bank</h4> <div class="form-group"> <label class="control-label requiredField" for="bank-name"> Bank Name<span class="asteriskField">*</span> </label> <input is="iron-input" bind-value="{{intBankAccount.bank.name}}" class="form-control" id="bank-name" type="text" maxlength="255" required> </div> <div class="form-group"> <label class="control-label requiredField" for="account-bic"> Bank SWIFT/BIC<span class="asteriskField">*</span> </label> <input is="iron-input" bind-value="{{intBankAccount.account.bic}}" class="form-control" id="account-bic" type="text" maxlength="255" required> </div> <div class="form-group"> <label class="control-label requiredField" for="account-number"> Account number (IBAN)<span class="asteriskField">*</span> </label> <input is="iron-input" bind-value="{{intBankAccount.account.number}}" class="form-control" id="account-number" type="text" maxlength="255" required> </div> <div class="form-group"> <label class="control-label requiredField" for="account-currency"> Account currency<span class="asteriskField">*</span> </label> <select class="select form-control" id="account-currency" value="{{intBankAccount.account.currency::change}}" required> <option value="">Select currency</option> <option value="EUR">EUR</option> <option value="USD">USD</option> <option value="GBP">GBP</option> <option value="DKK">DKK</option> </select> </div> <div class="form-group pull-right"> <div> <button class="btn btn-default" on-tap="_cancelCreateIntBankAccount" type="button"> Cancel </button> <button class="btn btn-success" type="submit"> Add bank account </button> </div> </div> </div> </div> <p class="error"></p> <div> <label for="email">E-mail</label> <input type="email" id="email" name="email" placeholder="john@example.com" required> </div> <div> <label for="name">Name</label> <input type="text" id="name" name="name" placeholder="John Doe" pattern="\w+ \w+.*" required> </div> <div> <label for="card-number">Card number</label> <input type="text" id="card-number" class="card-number" placeholder="0000  0000  0000  0000" pattern="[0-9]{4}  [0-9]{4}  [0-9]{4}  .*" required> </div> <div> <label for="card-expiry">Expiry date</label> <input type="text" id="card-expiry" class="card-expiry" placeholder="MM  /  YY" pattern="[0-9]{2}  /  ([0-9]{2}|[0-9]{4})" required> </div> <div> <label for="card-code">CVC</label> <input type="text" id="card-code" class="card-code" placeholder="***" maxlength="4" pattern="[0-9]{3,4}" required> </div> <input type="submit" value="Pay"> </form> <iron-ajax id="coinifyCallback" url="{{coinifyApiBaseUrl}}/card/callbacks/{{trade.transferIn.details.provider}}" on-error="_handleApiError" body="{{coinifyCallbackBody}}" method="POST" content-type="application/json" handle-as="json"> </iron-ajax> </template> <script src="https://sdk.paylike.io/3.js"></script> <script>Polymer({is:"coinify-paylike-payment-handler",behaviors:[CoinifyApiBehaviour],properties:{trade:Object,coinifyCallbackBody:Object},_submitPaylikeForm:function(){var e=this;if("paylike"!==this.trade.transferIn.details.provider)return console.error("Unknown provider. Supported providers: paylike");var r=Paylike(this.trade.transferIn.details.providerMerchantId,{style:!1});r.popup({currency:this.trade.transferIn.currency,amount:100*this.trade.transferIn.sendAmount,custom:{paymentId:this.trade.transferIn.details.cardPaymentId}},function(r,n){return r?console.warn(r):(e.coinifyCallbackBody={externalId:n.transaction.id},void e.$.coinifyCallback.generateRequest().completes.then(function(){e.fire("coinify-payment-completed",null,{bubbles:!0})},function(e){console.error(e)}))})},created:function(){window.performance&&performance.mark&&performance.mark("coinify-payment-handler.created"),this.removeAttribute("unresolved")}})</script> </dom-module>